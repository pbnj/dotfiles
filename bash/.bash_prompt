# Git settings
## If '__git_ps1' is not found, install:
##    curl -fsSLo ~/.git-prompt.sh https://github.com/git/git/raw/v$(git version | cut -d" " -f3)/contrib/completion/git-prompt.sh
[ -f "$HOME/.git-prompt.sh" ] && source "$HOME/.git-prompt.sh"

GIT_PS1_SHOWDIRTYSTATE=true
GIT_PS1_SHOWUNTRACKEDFILES=true
GIT_PS1_SHOWUPSTREAM=auto

# K8s settings
function __kube_ps1() {
	if command -v kubectl &>/dev/null; then
		KUBE_CTX="$(kubectl config current-context 2>/dev/null)"
		KUBE_NS="$(kubectl config view --minify --output 'jsonpath={..namespace}' 2>/dev/null)"
	fi

	KUBE_PS1=""
	[ -n "${KUBE_CTX}" ] && KUBE_PS1+="${KUBE_CTX}"
	[ -n "${KUBE_NS}" ] && KUBE_PS1+="/${KUBE_NS}"

	[ -n "${KUBE_PS1}" ] && echo "(${KUBE_PS1})"
}

# PS1='\n\u@\h \W$(__git_ps1 " (%s)") (${KUBE_PS1})\n\$ '
PROMPT_COMMAND='__git_ps1 "\n\u@\h:\w" " $(__kube_ps1)\n\\\$ "'
